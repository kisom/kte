#!/usr/bin/env bash

set -eu
set -o pipefail

mkdir -p cmake-build-release
cmake -S . -B cmake-build-release -DBUILD_GUI=ON -DCMAKE_BUILD_TYPE=Release -DENABLE_ASAN=OFF

cd cmake-build-release
make clean
rm -fr kge.app*
make
zip -r kge.app.zip kge.app 
sha256sum kge.app.zip
open .
cd ..

mkdir -p cmake-build-release-qt
cmake -S . -B cmake-build-release -DBUILD_GUI=ON -DCMAKE_BUILD_TYPE=Release -DENABLE_ASAN=OFF

cd cmake-build-release-qt
make clean
rm -fr kge.app* kge-qt.app*
make
mv kge.app kge-qt.app
macdeployqt kge-qt.app -always-overwrite
zip -r kge-qt.app.zip kge-qt.app 
sha256sum kge-qt.app.zip
open .
cd ..
